<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clothing Studio - 3D Shop</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #canvas {
            width: 100vw;
            height: 100vh;
            display: block;
        }
        #shop-ui {
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            max-height: 100vh;
            overflow-y: auto;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
        }
        .clothing-item {
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .clothing-item:hover {
            background-color: #f1f1f1;
        }
        #preview-canvas {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 1px solid #ccc;
            display: none;
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            display: none;
        }
        @media (max-width: 640px) {
            #shop-ui {
                width: 100%;
                bottom: 0;
                top: auto;
                max-height: 50vh;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="loading" class="text-xl text-gray-800">Loading...</div>
    <canvas id="canvas"></canvas>
    <div id="shop-ui" class="text-gray-800">
        <h2 class="text-2xl font-bold mb-4">Shop Clothing</h2>
        <div class="mb-4">
            <label for="filter" class="mr-2">Filter by Type:</label>
            <select id="filter" class="p-2 border rounded">
                <option value="all">All</option>
                <option value="shirt">Shirt</option>
                <option value="pants">Pants</option>
                <option value="hoodie">Hoodie</option>
                <option value="jacket">Jacket</option>
                <option value="sweater">Sweater</option>
                <option value="blazer">Blazer</option>
            </select>
        </div>
        <div id="clothing-list"></div>
    </div>
    <div id="preview-canvas">
        <canvas id="preview"></canvas>
        <button id="close-preview" class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Close</button>
    </div>

    <script>
        // Check WebGL Support
        if (!window.WebGLRenderingContext || !document.createElement('canvas').getContext('webgl')) {
            document.body.innerHTML = '<div class="text-center p-4 text-red-600">WebGL is not supported in your browser. Please use a modern browser with WebGL enabled.</div>';
            throw new Error('WebGL not supported');
        }

        // Constants
        const PREVIEW_SIZE = Math.min(window.innerWidth * 0.4, 400); // Dynamic preview size
        const clothingItems = [
            { name: "White T-Shirt", color: 0xffffff, type: "shirt", price: 24.99 },
            { name: "Black T-Shirt", color: 0x000000, type: "shirt", price: 24.99 },
            { name: "Blue Jeans", color: 0x0000ff, type: "pants", price: 49.99 },
            { name: "Black Jeans", color: 0x000000, type: "pants", price: 49.99 },
            { name: "Red Hoodie", color: 0xff0000, type: "hoodie", price: 39.99 },
            { name: "Green Jacket", color: 0x00ff00, type: "jacket", price: 59.99 },
            { name: "Gray Sweater", color: 0x888888, type: "sweater", price: 34.99 },
            { name: "Navy Blazer", color: 0x000080, type: "blazer", price: 79.99 },
            { name: "White Shirt", color: 0xffffff, type: "shirt", price: 29.99 },
            { name: "Khaki Pants", color: 0xc2b280, type: "pants", price: 44.99 },
            { name: "Black Hoodie", color: 0x000000, type: "hoodie", price: 39.99 },
            { name: "Denim Jacket", color: 0x1e90ff, type: "jacket", price: 64.99 }
        ];

        // Main Scene Setup
        function createMainScene() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            const pointLight = new THREE.PointLight(0xffffff, 1, 100);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            // Room
            const roomMaterial = new THREE.MeshStandardMaterial({ color: 0xf5f5f5 });
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(20, 20), new THREE.MeshStandardMaterial({ color: 0xcccccc }));
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -2;
            scene.add(floor);

            const walls = [
                new THREE.Mesh(new THREE.PlaneGeometry(20, 10), roomMaterial),
                new THREE.Mesh(new THREE.PlaneGeometry(20, 10), roomMaterial),
                new THREE.Mesh(new THREE.PlaneGeometry(20, 10), roomMaterial),
                new THREE.Mesh(new THREE.PlaneGeometry(20, 10), roomMaterial)
            ];
            walls[0].position.set(0, 3, -10);
            walls[1].position.set(0, 3, 10);
            walls[1].rotation.y = Math.PI;
            walls[2].position.set(-10, 3, 0);
            walls[2].rotation.y = Math.PI / 2;
            walls[3].position.set(10, 3, 0);
            walls[3].rotation.y = -Math.PI / 2;
            walls.forEach(wall => scene.add(wall));

            // Hacker Desk
            const deskMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const desk = new THREE.Mesh(new THREE.BoxGeometry(3, 0.2, 1.5), deskMaterial);
            desk.position.set(-5, -1.8, 0);
            scene.add(desk);

            const monitor = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1, 0.2), new THREE.MeshStandardMaterial({ color: 0x222222 }));
            monitor.position.set(-5, -1, 0);
            scene.add(monitor);

            const keyboard = new THREE.Mesh(new THREE.BoxGeometry(1, 0.1, 0.4), new THREE.MeshStandardMaterial({ color: 0x111111 }));
            keyboard.position.set(-5, -1.6, 0.3);
            scene.add(keyboard);

            const mouse = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.1, 0.1), new THREE.MeshStandardMaterial({ color: 0x555555 }));
            mouse.position.set(-4.5, -1.6, 0.3);
            scene.add(mouse);

            // Hanger Rack
            const rackPole = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 5, 32), new THREE.MeshStandardMaterial({ color: 0x666666 }));
            rackPole.position.set(5, 0, 0);
            rackPole.rotation.z = Math.PI / 2;
            scene.add(rackPole);

            const rackSupports = [
                new THREE.Mesh(new THREE.BoxGeometry(0.2, 2, 0.2), new THREE.MeshStandardMaterial({ color: 0x666666 })),
                new THREE.Mesh(new THREE.BoxGeometry(0.2, 2, 0.2), new THREE.MeshStandardMaterial({ color: 0x666666 }))
            ];
            rackSupports[0].position.set(2.5, -1, 0);
            rackSupports[1].position.set(7.5, -1, 0);
            rackSupports.forEach(support => scene.add(support));

            // Clothing Items
            const clothingMeshes = clothingItems.map((item, index) => {
                const geometry = item.type === "shirt" || item.type === "hoodie" || item.type === "sweater" || item.type === "blazer" || item.type === "jacket"
                    ? new THREE.BoxGeometry(0.5, 0.8, 0.1)
                    : new THREE.CylinderGeometry(0.2, 0.2, 0.8, 16);
                const material = new THREE.MeshStandardMaterial({ color: item.color });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(2.5 + (index * 0.4), 1.5, 0);
                mesh.userData = { ...item };
                scene.add(mesh);
                return mesh;
            });

            camera.position.set(0, 2, 10);
            controls.update();

            return { scene, camera, renderer, controls, clothingMeshes };
        }

        // Preview Scene Setup
        function createPreviewScene() {
            const previewCanvas = document.getElementById('preview');
            const previewRenderer = new THREE.WebGLRenderer({ canvas: previewCanvas, antialias: true });
            previewRenderer.setSize(PREVIEW_SIZE, PREVIEW_SIZE);
            const previewScene = new THREE.Scene();
            const previewCamera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            previewCamera.position.z = 2;
            const previewControls = new THREE.OrbitControls(previewCamera, previewRenderer.domElement);
            previewControls.enableDamping = true;
            previewScene.add(new THREE.AmbientLight(0xffffff, 0.8));
            const previewPointLight = new THREE.PointLight(0xffffff, 1, 100);
            previewPointLight.position.set(5, 5, 5);
            previewScene.add(previewPointLight);

            return { previewScene, previewCamera, previewRenderer, previewControls };
        }

        // Dispose Meshes
        function disposeMesh(mesh) {
            if (mesh.geometry) mesh.geometry.dispose();
            if (mesh.material) {
                if (Array.isArray(mesh.material)) {
                    mesh.material.forEach(mat => mat.dispose());
                } else {
                    mesh.material.dispose();
                }
            }
        }

        // Main Animation Loop
        let previewAnimationId = null;
        function animate(mainScene, previewScene) {
            requestAnimationFrame(() => animate(mainScene, previewScene));
            mainScene.controls.update();
            mainScene.renderer.render(mainScene.scene, mainScene.camera);
            if (previewScene.previewMesh) {
                previewScene.previewControls.update();
                previewScene.previewRenderer.render(previewScene.previewScene, previewScene.previewCamera);
            }
        }

        // Shop UI
        function updateClothingList(filter = 'all') {
            const clothingList = document.getElementById('clothing-list');
            clothingList.innerHTML = '';
            const filteredItems = filter === 'all' ? clothingItems : clothingItems.filter(item => item.type === filter);
            filteredItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'clothing-item p-4 mb-2 border rounded';
                div.innerHTML = `
                    <h3 class="text-lg font-semibold">${item.name}</h3>
                    <p>Type: ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</p>
                    <p>Price: $${item.price.toFixed(2)}</p>
                `;
                div.addEventListener('click', () => showPreview(mainScene.clothingMeshes[clothingItems.indexOf(item)]));
                clothingList.appendChild(div);
            });
        }

        // Show Preview
        function showPreview(mesh) {
            // Clear previous meshes
            previewScene.previewScene.children = previewScene.previewScene.children.filter(child => child.isLight);
            const previewMesh = mesh.clone();
            previewScene.previewScene.add(previewMesh);
            previewScene.previewMesh = previewMesh;
            document.getElementById('preview-canvas').style.display = 'block';
        }

        // Initialize
        document.getElementById('loading').style.display = 'block';
        const mainScene = createMainScene();
        const previewScene = createPreviewScene();
        document.getElementById('loading').style.display = 'none';

        // Event Listeners
        window.addEventListener('resize', () => {
            mainScene.camera.aspect = window.innerWidth / window.innerHeight;
            mainScene.camera.updateProjectionMatrix();
            mainScene.renderer.setSize(window.innerWidth, window.innerHeight);
            const newSize = Math.min(window.innerWidth * 0.4, 400);
            previewScene.previewRenderer.setSize(newSize, newSize);
        });

        document.getElementById('filter').addEventListener('change', (e) => updateClothingList(e.target.value));

        document.getElementById('close-preview').addEventListener('click', () => {
            document.getElementById('preview-canvas').style.display = 'none';
            if (previewScene.previewMesh) {
                disposeMesh(previewScene.previewMesh);
                previewScene.previewMesh = null;
            }
        });

        // Click outside to close preview
        document.getElementById('preview-canvas').addEventListener('click', (e) => {
            if (e.target === document.getElementById('preview-canvas')) {
                document.getElementById('close-preview').click();
            }
        });

        // Start Animation
        updateClothingList();
        animate(mainScene, previewScene);
    </script>
</body>
</html>
