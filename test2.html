<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clothing Studio - 3D Shop</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js CDN (updated to r169) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r169/three.min.js"></script>
    <!-- OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/controls/OrbitControls.js" type="module"></script>
    <!-- Post-processing -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/EffectComposer.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/RenderPass.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/UnrealBloomPass.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/ShaderPass.js" type="module"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        #canvas {
            width: 100vw;
            height: 100vh;
            display: block;
        }
        #shop-ui {
            position: absolute;
            top: 0;
            right: 0;
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            max-height: 100vh;
            overflow-y: auto;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        #shop-ui.hidden {
            transform: translateX(100%);
        }
        .clothing-item {
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            border-radius: 8px;
        }
        .clothing-item:hover {
            background-color: #f1f1f1;
            transform: scale(1.02);
        }
        #preview-canvas {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }
        #header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to right, #1e3a8a, #3b82f6);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 500;
        }
        #header a {
            color: white;
            margin: 0 15px;
            transition: color 0.3s;
        }
        #header a:hover {
            color: #ffcc00;
        }
        #toggle-ui {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 600;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <div id="header">
        <h1 class="text-2xl font-bold">Clothing Studio</h1>
        <div>
            <a href="#home">Home</a>
            <a href="#shop">Shop</a>
            <a href="#cart">Cart</a>
        </div>
    </div>
    <canvas id="canvas"></canvas>
    <button id="toggle-ui" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Toggle UI</button>
    <div id="shop-ui" class="text-gray-800">
        <h2 class="text-2xl font-bold mb-4">Shop Clothing</h2>
        <div class="mb-4">
            <label for="category" class="block text-sm font-medium">Filter by Category</label>
            <select id="category" class="w-full p-2 border rounded">
                <option value="all">All</option>
                <option value="shirt">Shirts</option>
                <option value="pants">Pants</option>
                <option value="jacket">Jackets</option>
                <option value="dress">Dresses</option>
                <option value="accessory">Accessories</option>
            </select>
        </div>
        <div id="clothing-list"></div>
    </div>
    <div id="preview-canvas">
        <canvas id="preview" style="width: 300px; height: 300px;"></canvas>
        <button id="close-preview" class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Close</button>
    </div>

    <script type="module">
        import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/controls/OrbitControls.js';
        import { EffectComposer } from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/EffectComposer.js';
        import { RenderPass } from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/postprocessing/UnrealBloomPass.js';

        // Main Scene Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;

        // Post-processing
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.5, 0.4, 0.85);
        composer.addPass(bloomPass);

        // Orbit Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 5;
        controls.maxDistance = 15;
        controls.maxPolarAngle = Math.PI / 2;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        const spotLight = new THREE.SpotLight(0xffffff, 1.5, 20, Math.PI / 6);
        spotLight.position.set(0, 8, 0);
        spotLight.target.position.set(0, 0, 0);
        scene.add(spotLight);
        scene.add(spotLight.target);

        // Textures
        const textureLoader = new THREE.TextureLoader();
        const floorTexture = textureLoader.load('https://threejsfundamentals.org/threejs/resources/images/checker.png');
        floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set(4, 4);
        const wallTexture = textureLoader.load('https://threejsfundamentals.org/threejs/resources/images/wall.jpg');
        wallTexture.wrapS = wallTexture.wrapT = THREE.RepeatWrapping;
        wallTexture.repeat.set(2, 2);

        // Room
        const floor = new THREE.Mesh(
            new THREE.PlaneGeometry(20, 20),
            new THREE.MeshPhysicalMaterial({ map: floorTexture, roughness: 0.7, metalness: 0.1 })
        );
        floor.rotation.x = -Math.PI / 2;
        floor.position.y = -2;
        floor.receiveShadow = true;
        scene.add(floor);

        const wallMaterial = new THREE.MeshPhysicalMaterial({ map: wallTexture, roughness: 0.8, metalness: 0.2 });
        const walls = [
            new THREE.Mesh(new THREE.PlaneGeometry(20, 10), wallMaterial), // Back
            new THREE.Mesh(new THREE.PlaneGeometry(20, 10), wallMaterial), // Front
            new THREE.Mesh(new THREE.PlaneGeometry(20, 10), wallMaterial), // Left
            new THREE.Mesh(new THREE.PlaneGeometry(20, 10), wallMaterial)  // Right
        ];
        walls[0].position.set(0, 3, -10);
        walls[1].position.set(0, 3, 10);
        walls[1].rotation.y = Math.PI;
        walls[2].position.set(-10, 3, 0);
        walls[2].rotation.y = Math.PI / 2;
        walls[3].position.set(10, 3, 0);
        walls[3].rotation.y = -Math.PI / 2;
        walls.forEach(wall => {
            wall.receiveShadow = true;
            scene.add(wall);
        });

        // Checkout Counter
        const counter = new THREE.Mesh(
            new THREE.BoxGeometry(4, 1.5, 1.5),
            new THREE.MeshPhysicalMaterial({ color: 0x4b2e1e, roughness: 0.5, metalness: 0.1 })
        );
        counter.position.set(-5, -1.25, -5);
        scene.add(counter);

        const computer = new THREE.Mesh(
            new THREE.BoxGeometry(1.5, 1, 0.2),
            new THREE.MeshPhysicalMaterial({ color: 0x222222, roughness: 0.3, metalness: 0.5 })
        );
        computer.position.set(-5, -0.5, -5);
        scene.add(computer);

        const scanner = new THREE.Mesh(
            new THREE.BoxGeometry(0.5, 0.3, 0.5),
            new THREE.MeshPhysicalMaterial({ color: 0x888888, roughness: 0.4, metalness: 0.6 })
        );
        scanner.position.set(-4, -0.5, -4.5);
        scene.add(scanner);

        // Shipping Boxes
        const boxTexture = textureLoader.load('https://threejsfundamentals.org/threejs/resources/images/cardboard.jpg');
        const boxMaterial = new THREE.MeshPhysicalMaterial({ map: boxTexture, roughness: 0.9, metalness: 0.1 });
        const boxes = [
            new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), boxMaterial),
            new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.8, 0.8), boxMaterial),
            new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), boxMaterial)
        ];
        boxes[0].position.set(7, -1.5, -7);
        boxes[1].position.set(7, -0.5, -7);
        boxes[2].position.set(6, -1, -7);
        boxes.forEach(box => {
            box.rotation.y = Math.random() * Math.PI;
            scene.add(box);
        });

        // Decorations
        const shelf = new THREE.Mesh(
            new THREE.BoxGeometry(5, 3, 0.5),
            new THREE.MeshPhysicalMaterial({ color: 0x333333, roughness: 0.6, metalness: 0.2 })
        );
        shelf.position.set(-5, 0, 8);
        scene.add(shelf);

        const mannequin = new THREE.Mesh(
            new THREE.CylinderGeometry(0.3, 0.3, 2, 32),
            new THREE.MeshPhysicalMaterial({ color: 0xcccccc, roughness: 0.7, metalness: 0.3 })
        );
        mannequin.position.set(0, -1, 5);
        scene.add(mannequin);

        const rug = new THREE.Mesh(
            new THREE.CircleGeometry(2, 32),
            new THREE.MeshPhysicalMaterial({ color: 0x8b0000, roughness: 0.9, metalness: 0.0 })
        );
        rug.rotation.x = -Math.PI / 2;
        rug.position.set(0, -1.95, 0);
        scene.add(rug);

        // Clothing Items (20 items)
        const clothingItems = [
            { name: "White T-Shirt", color: 0xffffff, type: "shirt", texture: null },
            { name: "Black T-Shirt", color: 0x000000, type: "shirt", texture: null },
            { name: "Blue Jeans", color: 0x0000ff, type: "pants", texture: 'https://threejsfundamentals.org/threejs/resources/images/denim.jpg' },
            { name: "Black Jeans", color: 0x000000, type: "pants", texture: null },
            { name: "Red Hoodie", color: 0xff0000, type: "hoodie", texture: null },
            { name: "Green Jacket", color: 0x00ff00, type: "jacket", texture: null },
            { name: "Gray Sweater", color: 0x888888, type: "sweater", texture: null },
            { name: "Navy Blazer", color: 0x000080, type: "blazer", texture: null },
            { name: "White Shirt", color: 0xffffff, type: "shirt", texture: null },
            { name: "Khaki Pants", color: 0xc2b280, type: "pants", texture: null },
            { name: "Black Hoodie", color: 0x000000, type: "hoodie", texture: null },
            { name: "Denim Jacket", color: 0x1e90ff, type: "jacket", texture: 'https://threejsfundamentals.org/threejs/resources/images/denim.jpg' },
            { name: "Floral Dress", color: 0xff69b4, type: "dress", texture: null },
            { name: "Black Dress", color: 0x000000, type: "dress", texture: null },
            { name: "Leather Belt", color: 0x3c2f2f, type: "accessory", texture: null },
            { name: "Sunglasses", color: 0x000000, type: "accessory", texture: null },
            { name: "Red Scarf", color: 0xff0000, type: "accessory", texture: null },
            { name: "Wool Coat", color: 0x333333, type: "jacket", texture: null },
            { name: "Chinos", color: 0x8b8b83, type: "pants", texture: null },
            { name: "Graphic Tee", color: 0xffffff, type: "shirt", texture: 'https://threejsfundamentals.org/threejs/resources/images/graphic.jpg' }
        ];

        const clothingMeshes = [];
        clothingItems.forEach((item, index) => {
            let geometry;
            if (item.type === "shirt" || item.type === "hoodie" || item.type === "sweater" || item.type === "blazer" || item.type === "jacket") {
                geometry = new THREE.BoxGeometry(0.5, 0.8, 0.1);
            } else if (item.type === "pants") {
                geometry = new THREE.CylinderGeometry(0.2, 0.2, 0.8, 16);
            } else if (item.type === "dress") {
                geometry = new THREE.CylinderGeometry(0.3, 0.5, 1.2, 16);
            } else {
                geometry = new THREE.BoxGeometry(0.3, 0.3, 0.3); // Accessories
            }
            const material = new THREE.MeshPhysicalMaterial({
                color: item.color,
                map: item.texture ? textureLoader.load(item.texture) : null,
                roughness: 0.7,
                metalness: 0.2
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(2.5 + (index % 10) * 0.4, 1.5 - Math.floor(index / 10) * 1, 0);
            mesh.userData = { name: item.name, type: item.type };
            mesh.castShadow = true;
            scene.add(mesh);
            clothingMeshes.push(mesh);
        });

        // Camera Position
        camera.position.set(0, 2, 10);
        controls.update();

        // Raycasting for Interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clothingMeshes);
            if (intersects.length > 0) {
                showPreview(intersects[0].object);
            }
        }
        window.addEventListener('click', onMouseClick);

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            composer.render();
        }
        animate();

        // Window Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // Shop UI
        const clothingList = document.getElementById('clothing-list');
        const categoryFilter = document.getElementById('category');
        function updateClothingList(filter = 'all') {
            clothingList.innerHTML = '';
            clothingItems.forEach((item, index) => {
                if (filter === 'all' || item.type === filter) {
                    const div = document.createElement('div');
                    div.className = 'clothing-item p-4 mb-2 border rounded';
                    div.innerHTML = `
                        <h3 class="text-lg font-semibold">${item.name}</h3>
                        <p>Type: ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</p>
                        <p>Price: $${(Math.random() * 50 + 20).toFixed(2)}</p>
                    `;
                    div.addEventListener('click', () => showPreview(clothingMeshes[index]));
                    clothingList.appendChild(div);
                }
            });
        }
        updateClothingList();
        categoryFilter.addEventListener('change', () => updateClothingList(categoryFilter.value));

        // Toggle UI
        const shopUI = document.getElementById('shop-ui');
        document.getElementById('toggle-ui').addEventListener('click', () => {
            shopUI.classList.toggle('hidden');
        });

        // Preview Canvas
        const previewCanvas = document.getElementById('preview');
        const previewRenderer = new THREE.WebGLRenderer({ canvas: previewCanvas, antialias: true });
        previewRenderer.setSize(300, 300);
        const previewScene = new THREE.Scene();
        const previewCamera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        previewCamera.position.z = 2;
        const previewControls = new OrbitControls(previewCamera, previewRenderer.domElement);
        previewControls.enableDamping = true;
        const previewLight = new THREE.AmbientLight(0xffffff, 0.8);
        previewScene.add(previewLight);
        const previewPointLight = new THREE.PointLight(0xffffff, 1, 100);
        previewPointLight.position.set(5, 5, 5);
        previewScene.add(previewPointLight);

        function showPreview(mesh) {
            previewScene.children = previewScene.children.filter(child => child.isLight);
            const previewMesh = mesh.clone();
            previewScene.add(previewMesh);
            document.getElementById('preview-canvas').style.display = 'block';

            function previewAnimate() {
                requestAnimationFrame(previewAnimate);
                previewControls.update();
                previewRenderer.render(previewScene, previewCamera);
            }
            previewAnimate();
        }

        document.getElementById('close-preview').addEventListener('click', () => {
            document.getElementById('preview-canvas').style.display = 'none';
        });
    </script>
</body>
</html>
