<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webXOS Studio</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
            width: 100vw !important;
            height: 100vh !important;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            z-index: 10;
        }
        .sidebar.open {
            left: 0;
        }
        .sidebar h1 {
            font-size: 1.8rem;
            color: #00ff00;
            margin-bottom: 15px;
            margin-top: 50px;
        }
        .sidebar ul {
            list-style: none;
        }
        .sidebar li {
            margin: 10px 0;
        }
        .sidebar a {
            color: #aaa6c3;
            text-decoration: none;
            font-size: 1.1rem;
            display: block;
            padding: 5px;
        }
        .menu-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 8px;
            background: #00ff00;
            color: #000000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 11;
            touch-action: none;
        }
        .text-overlay {
            position: absolute;
            bottom: 15px;
            left: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            color: #ffffff;
            font-size: 1rem;
            z-index: 10;
            max-width: 80%;
        }
        .center-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff00;
            border-radius: 5px;
            color: #00ff00;
            font-size: 1.5rem;
            text-align: center;
            z-index: 10;
            max-height: 80vh;
            overflow-y: auto;
        }
        .center-overlay button {
            margin: 5px;
            padding: 5px 10px;
            background: #00ff00;
            color: #000000;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .center-overlay button.remove {
            background: #ff5555;
            color: #ffffff;
        }
        .center-overlay ul {
            list-style: none;
            margin: 10px 0;
            padding: 0;
        }
        .center-overlay li {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .shop-item {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            width: 300px;
            text-align: left;
        }
        .shop-item h3 {
            color: #00ff00;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .shop-item p {
            color: #aaa6c3;
            font-size: 0.9rem;
            margin: 5px 0;
        }
        .shop-item button {
            width: 100%;
            margin-top: 10px;
        }
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff5555;
            font-size: 1.5rem;
            text-align: center;
            z-index: 10;
        }
        @media (max-width: 768px) {
            canvas {
                width: 100vw !important;
                height: 100vh !important;
            }
            .sidebar {
                width: 150px;
                left: -150px;
            }
            .sidebar h1 {
                font-size: 1.3rem;
                margin-top: 40px;
            }
            .sidebar a {
                font-size: 0.9rem;
                padding: 8px;
            }
            .menu-toggle {
                padding: 6px;
                font-size: 0.8rem;
            }
            .text-overlay {
                font-size: 0.9rem;
                padding: 8px;
                bottom: 10px;
                left: 10px;
            }
            .center-overlay {
                font-size: 1.2rem;
                padding: 10px;
            }
            .center-overlay button {
                font-size: 0.8rem;
                padding: 4px 8px;
            }
            .shop-item {
                width: 200px;
            }
            .shop-item h3 {
                font-size: 1rem;
            }
            .shop-item p {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <button class="menu-toggle" onclick="toggleMenu()">â˜° Menu</button>
    <div class="sidebar" id="sidebar">
        <h1>webXOS Studio</h1>
        <ul>
            <li><a href="#" onclick="navigateTo('about')">About</a></li>
            <li><a href="#" onclick="navigateTo('tools')">Tools</a></li>
            <li><a href="#" onclick="navigateTo('aiAgents')">AI Agents</a></li>
            <li><a href="#" onclick="navigateTo('games')">Games</a></li>
            <li><a href="#" onclick="navigateTo('copyright')">Copyright</a></li>
        </ul>
    </div>
    <div class="text-overlay" id="textOverlay"></div>
    <div class="center-overlay" id="centerOverlay"></div>
    <div class="error-message" id="errorMessage" style="display: none;"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        // Check WebGL support
        const canvas = document.getElementById('canvas');
        const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
        if (!gl) {
            const errorMsg = 'WebGL not supported. Please use a modern browser (Chrome, Firefox, Edge) or enable WebGL.';
            document.getElementById('errorMessage').innerText = errorMsg;
            document.getElementById('errorMessage').style.display = 'block';
            console.error(errorMsg);
            throw new Error(errorMsg);
        }

        // Scene setup
        let scene, camera, renderer;
        try {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        } catch (e) {
            const errorMsg = `Renderer setup failed: ${e.message}`;
            document.getElementById('errorMessage').innerText = errorMsg;
            document.getElementById('errorMessage').style.display = 'block';
            console.error(errorMsg);
            throw e;
        }

        // Lighting
        try {
            const ambientLight = new THREE.AmbientLight(0x00ff00, 0.6);
            scene.add(ambientLight);
            const naturalAmbientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(naturalAmbientLight);
            const spotlight = new THREE.SpotLight(0x00ff00, 2);
            spotlight.position.set(0, 5, 4);
            spotlight.angle = Math.PI / 6;
            spotlight.penumbra = 0.5;
            spotlight.castShadow = true;
            spotlight.target.position.set(0, 0, 4);
            scene.add(spotlight);
            scene.add(spotlight.target);
        } catch (e) {
            console.error('Lighting setup failed:', e);
        }

        // Floor
        try {
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x1c1c1c,
                roughness: 0.7,
                metalness: 0.5
            });
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
        } catch (e) {
            console.error('Floor setup failed:', e);
        }

        // Rug with Spider Web Pattern
        try {
            const rugCanvas = document.createElement('canvas');
            rugCanvas.width = 512;
            rugCanvas.height = 512;
            const rugContext = rugCanvas.getContext('2d');
            rugContext.fillStyle = '#000000';
            rugContext.fillRect(0, 0, rugCanvas.width, rugCanvas.height);

            rugContext.strokeStyle = '#00ff00';
            rugContext.lineWidth = 3;
            const centerX = rugCanvas.width / 2;
            const centerY = rugCanvas.height / 2;
            for (let angle = 0; angle < 2 * Math.PI; angle += Math.PI / 8) {
                rugContext.beginPath();
                rugContext.moveTo(centerX, centerY);
                rugContext.lineTo(
                    centerX + Math.cos(angle) * rugCanvas.width / 2,
                    centerY + Math.sin(angle) * rugCanvas.height / 2
                );
                rugContext.stroke();
            }
            for (let r = 50; r <= 200; r += 30) {
                rugContext.beginPath();
                for (let angle = 0; angle < 2 * Math.PI; angle += 0.1) {
                    const x = centerX + Math.cos(angle) * r;
                    const y = centerY + Math.sin(angle) * r;
                    if (angle === 0) rugContext.moveTo(x, y);
                    else rugContext.lineTo(x, y);
                }
                rugContext.closePath();
                rugContext.stroke();
            }

            const rugTexture = new THREE.CanvasTexture(rugCanvas);
            const rugMaterial = new THREE.MeshStandardMaterial({
                map: rugTexture,
                roughness: 1.0,
                metalness: 0.0,
                emissive: 0x00ff00,
                emissiveIntensity: 1.0,
                emissiveMap: rugTexture
            });
            const rugGeometry = new THREE.PlaneGeometry(5, 5);
            const rug = new THREE.Mesh(rugGeometry, rugMaterial);
            rug.rotation.x = -Math.PI / 2;
            rug.position.set(0, 0.01, 0);
            scene.add(rug);
        } catch (e) {
            console.error('Rug setup failed:', e);
        }

        // Walls
        try {
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x000000,
                roughness: 0.8,
                metalness: 0.2
            });
            const wall1 = new THREE.Mesh(new THREE.PlaneGeometry(10, 5), wallMaterial);
            wall1.position.set(0, 2.5, -5);
            scene.add(wall1);
            const wall2 = new THREE.Mesh(new THREE.PlaneGeometry(10, 5), wallMaterial);
            wall2.position.set(-5, 2.5, 0);
            wall2.rotation.y = Math.PI / 2;
            scene.add(wall2);
            const wall3 = new THREE.Mesh(new THREE.PlaneGeometry(10, 5), wallMaterial);
            wall3.position.set(0, 2.5, 5);
            scene.add(wall3);
        } catch (e) {
            console.error('Walls setup failed:', e);
        }

        // Matte Black Material
        let matteBlackMaterial;
        try {
            matteBlackMaterial = new THREE.MeshStandardMaterial({
                color: 0x000000,
                roughness: 1.0,
                metalness: 0.0
            });
        } catch (e) {
            console.error('Matte black material setup failed:', e);
        }

        // Desk
        try {
            const deskGeometry = new THREE.BoxGeometry(4, 0.1, 1.8);
            const desk = new THREE.Mesh(deskGeometry, matteBlackMaterial);
            desk.position.set(0, 0.75, 4);
            desk.castShadow = true;
            scene.add(desk);

            const legGeometry = new THREE.BoxGeometry(0.1, 0.75, 0.1);
            const leg1 = new THREE.Mesh(legGeometry, matteBlackMaterial);
            leg1.position.set(-1.9, 0.35, 4.8);
            scene.add(leg1);
            const leg2 = new THREE.Mesh(legGeometry, matteBlackMaterial);
            leg2.position.set(1.9, 0.35, 4.8);
            scene.add(leg2);
            const leg3 = new THREE.Mesh(legGeometry, matteBlackMaterial);
            leg3.position.set(-1.9, 0.35, 3.2);
            scene.add(leg3);
            const leg4 = new THREE.Mesh(legGeometry, matteBlackMaterial);
            leg4.position.set(1.9, 0.35, 3.2);
            scene.add(leg4);

            // Desk Neon Lights
            const deskNeonPositions = [
                [-2, 0.8, 4.9], [2, 0.8, 4.9],
                [-2, 0.8, 3.1], [2, 0.8, 3.1]
            ];
            deskNeonPositions.forEach(pos => {
                const neonLight = new THREE.PointLight(0x00ff00, 1, 2);
                neonLight.position.set(...pos);
                scene.add(neonLight);
                const neonGlow = new THREE.Mesh(
                    new THREE.SphereGeometry(0.05, 16, 16),
                    new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.8 })
                );
                neonGlow.position.set(...pos);
                scene.add(neonGlow);
            });
        } catch (e) {
            console.error('Desk setup failed:', e);
        }

        // Sofa
        try {
            const sofaBaseGeometry = new THREE.BoxGeometry(4.5, 0.5, 1);
            const sofaBackGeometry = new THREE.BoxGeometry(4.5, 1, 0.3);
            const sofaArmGeometry = new THREE.BoxGeometry(0.5, 0.5, 1);
            const sofaCushionGeometry = new THREE.BoxGeometry(1.4, 0.2, 0.8);

            const sofaBase = new THREE.Mesh(sofaBaseGeometry, matteBlackMaterial);
            sofaBase.position.set(0, 0.25, -4.2);
            sofaBase.castShadow = true;
            scene.add(sofaBase);

            const sofaBack = new THREE.Mesh(sofaBackGeometry, matteBlackMaterial);
            sofaBack.position.set(0, 0.75, -4.45);
            scene.add(sofaBack);

            const sofaArmLeft = new THREE.Mesh(sofaArmGeometry, matteBlackMaterial);
            sofaArmLeft.position.set(-2.25, 0.5, -4.2);
            scene.add(sofaArmLeft);

            const sofaArmRight = new THREE.Mesh(sofaArmGeometry, matteBlackMaterial);
            sofaArmRight.position.set(2.25, 0.5, -4.2);
            scene.add(sofaArmRight);

            for (let x = -1.5; x <= 1.5; x += 1.5) {
                const cushion = new THREE.Mesh(sofaCushionGeometry, matteBlackMaterial);
                cushion.position.set(x, 0.45, -4.2);
                scene.add(cushion);
            }

            // Sofa Neon Lights
            const sofaNeonPositions = [
                [-2.25, 0.75, -4.2], [2.25, 0.75, -4.2],
                [0, 0.75, -4.45]
            ];
            sofaNeonPositions.forEach(pos => {
                const neonLight = new THREE.PointLight(0x00ff00, 1, 2);
                neonLight.position.set(...pos);
                scene.add(neonLight);
                const neonGlow = new THREE.Mesh(
                    new THREE.SphereGeometry(0.05, 16, 16),
                    new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.8 })
                );
                neonGlow.position.set(...pos);
                scene.add(neonGlow);
            });
        } catch (e) {
            console.error('Sofa setup failed:', e);
        }

        // Neon Sign
        try {
            const signCanvas = document.createElement('canvas');
            signCanvas.width = 1024;
            signCanvas.height = 256;
            const signContext = signCanvas.getContext('2d');
            signContext.fillStyle = '#000000';
            signContext.fillRect(0, 0, signCanvas.width, signCanvas.height);
            signContext.font = '200px Arial';
            signContext.fillStyle = '#00ff00';
            signContext.textAlign = 'center';
            signContext.textBaseline = 'middle';
            signContext.fillText('webXOS', signCanvas.width / 2, signCanvas.height / 2);
            const signTexture = new THREE.CanvasTexture(signCanvas);

            const neonSignGeometry = new THREE.PlaneGeometry(3, 0.75);
            const neonSignMaterial = new THREE.MeshBasicMaterial({
                map: signTexture,
                transparent: true,
                emissive: 0x00ff00,
                emissiveIntensity: 2
            });
            const neonSign = new THREE.Mesh(neonSignGeometry, neonSignMaterial);
            neonSign.position.set(0, 3, -4.9);
            scene.add(neonSign);

            const signGlowLight = new THREE.PointLight(0x00ff00, 2, 5);
            signGlowLight.position.set(0, 3, -4.8);
            scene.add(signGlowLight);
        } catch (e) {
            console.error('Neon sign setup failed:', e);
        }

        // Page navigation and camera positions
        const pages = {
            about: {
                cameraPos: new THREE.Vector3(0, 2, 5),
                lookAt: new THREE.Vector3(0, 1, 0),
                text: "About: Learn more about webXOS Studio\nOur mission and vision.",
                centerText: "About webXOS Studio"
            },
            tools: {
                cameraPos: new THREE.Vector3(3.6, 2.4, 2.4),
                lookAt: new THREE.Vector3(-0.6, 0.85, 3.6),
                text: "Tools: Explore our suite of development tools\nDesigned for efficiency.",
                centerText: "Our Tools"
            },
            aiAgents: {
                cameraPos: new THREE.Vector3(5, 7, 5),
                lookAt: new THREE.Vector3(0, 0, 0),
                text: "AI Agents: Discover our intelligent agents\nPowering the future.",
                centerText: "AI Agents"
            },
            games: {
                cameraPos: new THREE.Vector3(-3.6, 2.4, 0),
                lookAt: new THREE.Vector3(0, 0.5, 2.5),
                text: "Games: Dive into our gaming experiences\nFun and immersive.",
                centerText: "Games by webXOS"
            },
            copyright: {
                cameraPos: new THREE.Vector3(2.4, 3, -2.4),
                lookAt: new THREE.Vector3(0, 3, -4.9),
                text: "Copyright: View our licensing information\nProtecting our work.",
                centerText: "Copyright Information"
            }
        };

        let currentPage = 'about';

        function navigateTo(page) {
            try {
                currentPage = page;
                const pageData = pages[page];
                camera.position.copy(pageData.cameraPos);
                camera.lookAt(pageData.lookAt);
                document.getElementById('textOverlay').innerText = pageData.text;
                document.getElementById('centerOverlay').innerHTML = pageData.centerText;
                toggleMenu();
            } catch (e) {
                console.error('Navigation failed:', e);
            }
        }

        // Initial page load
        try {
            navigateTo('about');
        } catch (e) {
            console.error('Initial navigation failed:', e);
        }

        // Animation loop
        let time = 0;
        function animate() {
            try {
                requestAnimationFrame(animate);
                time += 0.01;

                // Animate rug glow
                if (rug && rug.material) {
                    rug.material.emissiveIntensity = 1.0 + 0.5 * Math.sin(time * 1.5);
                }

                // Animate neon LEDs
                scene.children.forEach(child => {
                    if (child.material && child.material.color && child.material.color.getHex() === 0x00ff00 && child.geometry.type === 'SphereGeometry') {
                        child.material.emissiveIntensity = 0.5 + 0.5 * Math.sin(time * 2 + child.position.x);
                    }
                });

                renderer.render(scene, camera);
            } catch (e) {
                console.error('Animation loop failed:', e);
            }
        }
        animate();

        // Responsive handling
        window.addEventListener('resize', () => {
            try {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            } catch (e) {
                console.error('Resize handler failed:', e);
            }
        });

        // Menu toggle
        function toggleMenu() {
            try {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('open');
            } catch (e) {
                console.error('Menu toggle failed:', e);
            }
        }
    </script>
</body>
</html>
