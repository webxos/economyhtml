<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clothing Studio Hero Page</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        #error {
            position: absolute;
            top: 60px;
            left: 20px;
            color: red;
            font-family: Arial, sans-serif;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="info">Click a clothing item to zoom in!</div>
    <div id="error"></div>
    <!-- Use latest Three.js version from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r167/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/23.1.3/tween.min.js"></script>
    <!-- Local fallbacks (uncomment if CDN fails and you have these files locally) -->
    <!--
    <script src="./libs/three.min.js"></script>
    <script src="./libs/OrbitControls.js"></script>
    <script src="./libs/tween.min.js"></script>
    -->
    <script>
        // Check WebGL support
        if (!window.WebGLRenderingContext || !document.createElement('canvas').getContext('webgl')) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = 'WebGL is not supported in this browser. Please use a modern browser like Chrome or Firefox.';
            throw new Error('WebGL not supported');
        }

        // Scene setup
        let scene, camera, renderer, controls;
        try {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x808080); // Gray background
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15); // Adjusted closer for visibility
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
        } catch (e) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = 'Error initializing Three.js: ' + e.message;
            throw e;
        }

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8); // Increased intensity
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        // Orbit controls
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // Clothing items array
        const clothingItems = [];
        const clothingData = [
            { name: "Red T-Shirt", geometry: new THREE.BoxGeometry(2, 2, 0.2), color: 0xff0000, position: [-8, 4, 0] },
            { name: "Blue Jeans", geometry: new THREE.CylinderGeometry(0.8, 0.8, 3, 16), color: 0x0000ff, position: [-5, 4, 0] },
            { name: "Black Shoes", geometry: new THREE.BoxGeometry(1, 0.5, 2), color: 0x000000, position: [-2, 4, 0] },
            { name: "Brown Jacket", geometry: new THREE.BoxGeometry(2.5, 2.5, 0.3), color: 0x8b4513, position: [1, 4, 0] },
            { name: "Pink Dress", geometry: new THREE.ConeGeometry(1.5, 3, 16), color: 0xff69b4, position: [4, 4, 0] },
            { name: "Green Cap", geometry: new THREE.SphereGeometry(1, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2), color: 0x00ff00, position: [7, 4, 0] },
            { name: "Yellow Scarf", geometry: new THREE.BoxGeometry(2, 0.2, 0.5), color: 0xffff00, position: [-8, 1, 0] },
            { name: "White Shirt", geometry: new THREE.BoxGeometry(2, 2, 0.2), color: 0xffffff, position: [-5, 1, 0] },
            { name: "Black Belt", geometry: new THREE.TorusGeometry(1, 0.1, 8, 16), color: 0x000000, position: [-2, 1, 0] },
            { name: "Purple Skirt", geometry: new THREE.CylinderGeometry(1.2, 1.2, 1.5, 16), color: 0x800080, position: [1, 1, 0] },
            { name: "Orange Socks", geometry: new THREE.CylinderGeometry(0.5, 0.5, 1, 16), color: 0xffa500, position: [4, 1, 0] },
            { name: "Gray Hoodie", geometry: new THREE.BoxGeometry(2.5, 2.5, 0.3), color: 0x808080, position: [7, 1, 0] }
        ];

        // Create clothing items
        try {
            clothingData.forEach(data => {
                const material = new THREE.MeshPhongMaterial({ color: data.color, shininess: 30 });
                const mesh = new THREE.Mesh(data.geometry, material);
                mesh.position.set(...data.position);
                mesh.userData = { name: data.name };
                scene.add(mesh);
                clothingItems.push(mesh);
                // Float animation
                const initialY = data.position[1];
                new TWEEN.Tween(mesh.position)
                    .to({ y: initialY + 0.5 }, 2000)
                    .easing(TWEEN.Easing.Sinusoidal.InOut)
                    .yoyo(true)
                    .repeat(Infinity)
                    .start();
            });
        } catch (e) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = 'Error creating clothing items: ' + e.message;
            throw e;
        }

        // Raycaster for clicking
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let isZooming = false;

        function onMouseClick(event) {
            if (isZooming) return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clothingItems);
            if (intersects.length > 0) {
                const target = intersects[0].object;
                isZooming = true;
                controls.enabled = false;
                const targetPosition = target.position.clone().add(new THREE.Vector3(0, 0, 5));
                new TWEEN.Tween(camera.position)
                    .to(targetPosition, 1000)
                    .easing(TWEEN.Easing.Quadratic.InOut)
                    .onComplete(() => {
                        isZooming = false;
                        controls.enabled = true;
                        controls.target.copy(target.position);
                    })
                    .start();
                document.getElementById('info').textContent = `Viewing: ${target.userData.name}`;
            }
        }

        window.addEventListener('click', onMouseClick);

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Animation loop
        function animate(time) {
            try {
                requestAnimationFrame(animate);
                TWEEN.update(time);
                controls.update();
                renderer.render(scene, camera);
            } catch (e) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error in animation loop: ' + e.message;
            }
        }
        animate();
    </script>
</body>
</html>
